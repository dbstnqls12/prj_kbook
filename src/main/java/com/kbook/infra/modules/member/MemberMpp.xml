<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.kbook.infra.modules.member.MemberMpp">

<resultMap id="resultMapObj" type="com.kbook.infra.modules.member.Member"></resultMap>
	<sql id="selectCommon">
		FROM
			kbMember a
			left join kbMemberPhone b on b.kbmmSeq = a.kbmmSeq	
			left join kbMemberEmail c on c.kbmmSeq = a.kbmmSeq
		WHERE 1=1
			<choose>
				<when test="shKbmmDelNy == 1">AND kbmmDelNy=1</when>
				<when test="shKbmmDelNy == 0">AND kbmmDelNy=0</when>
			</choose>
			<choose>
				<when test="shOption == 1">AND kbmmName LIKE concat('%', #{shValue}, '%')</when>
				<when test="shOption == 2">AND kbmmId LIKE concat('%', #{shValue}, '%')</when>
			</choose>
	</sql>
	
	<select id="selectOneCount" resultType="Integer">
		SELECT
			count(*)
		<include refid="selectCommon"/>	
	</select>
	
	<select id="selectList" resultMap="resultMapObj">
		select
			a.kbmmSeq
			,a.kbmmId
			,a.kbmmName
			,b.kbmpNumberFull
			,c.kbmeEmailFull
			,a.kbmmAdminNy
		<include refid="selectCommon"/>	
		limit #{startRnumForMysql}, #{rowNumToShow}
	</select>
	
	<select id="selectOne" resultMap="resultMapObj">
		select
			a.kbmmSeq
			,a.kbmmId
			,a.kbmmName
			,a.kbmmDob
			,a.kbmmPassword
			,a.kbmmSavedCd
			,b.kbmpNumberFull
			,c.kbmeEmailFull
		FROM	
			kbMember a
			left join kbMemberPhone b on b.kbmmSeq = a.kbmmSeq	
			left join kbMemberEmail c on c.kbmmSeq = a.kbmmSeq
		WHERE 1=1
			AND a.kbmmSeq=#{kbmmSeq}
	</select>
	<select id="codeTelecom" resultMap="resultMapObj">
		SELECT
			a.ifcdSeq
			,a.ifcdName
			,a.ifcdOrder
			,a.ifcgSeq
		FROM	
			infrCode a
		WHERE 1=1
			AND a.ifcgSeq=10
	</select>
<!-- 	memberForm    -->
	
	<insert id="insert">
		INSERT INTO kbMember(
			kbmmName
			,kbmmGenderCd
			,kbmmId
			,kbmmPassword
			,kbmmDob
			,kbmmGradeCd
			,kbmmUseConsentNy_c
			,kbmmPersonalinfoConsentNy_c
			,kbmmPersonalinfoConsentNy_s
			,kbmmOfferinfo1ConsentNy_s
			,kbmmOfferinfo2ConsentNy_s
			,kbmmSmsConsentNy
			,kbmmEmailConsentNy
			,kbmmSavedCd
			,kbmmAdminNy
			,kbmmDelNy
		) VALUES (
			#{kbmmName}
			,#{kbmmGenderCd}
			,#{kbmmId}
			,#{kbmmPassword}
			,#{kbmmDob}
			,1
			,#{kbmmUseConsentNy_c}
			,#{kbmmPersonalinfoConsentNy_c}
			,#{kbmmPersonalinfoConsentNy_s}
			,#{kbmmOfferinfo1ConsentNy_s}
			,#{kbmmOfferinfo2ConsentNy_s}
			,#{kbmmSmsConsentNy}
			,#{kbmmEmailConsentNy}
			,#{kbmmSavedCd}
			,0
			,0
		)	
		<selectKey resultType="String" keyProperty="kbmmSeq" order="AFTER">
			SELECT last_insert_id()
		</selectKey>	
	</insert>
	<insert id="insertPhone">
		INSERT INTO kbMemberPhone(
			kbmpDefaultNy
			,kbmpTypeCd
			,kbmpDeviceCd
			,kbmpTelecomCd
			,kbmpNumberFull
			,kbmpDelNy
			,kbmmSeq
		) VALUES (
			1
			,1
			,2
			,#{kbmpTelecomCd}
			,#{kbmpNumberFull}
			,0
			,#{kbmmSeq}
		)		
	</insert>

	<insert id="insertEmail">
		INSERT INTO kbMemberEmail(
			kbmeDefaultNy
			,kbmeTypeCd
			,kbmeEmailFull
			,kbmeDelNy
			,kbmmSeq
		) VALUES (
			1
			,1
			,#{kbmeEmailFull}
			,0
			,#{kbmmSeq}
		)		
	</insert>

<!--  code 		-->
	
	

</mapper>


    